import sqlite3

DB_FILE = "library.db"

BAD_IDS = [3,7,8,9,10,11,12,40,43,44,58,60,62,66,68,69,72,75,77,78,85,90,91,92,99,106,108,111,114,116,117,119,120,122,125,128,130,131,134,135,136,137,138,139,140,143,144,146,151,152,159,164,168,171,175,179,182,183,190,191,192,197,199,205,209,212,213,215,216,220,221,225,227,228,229,230,233,234,235,238,240,241,245,246,259,270,277,279,281,283,286,290,291,301,307,308,319,320,321,328,329,332,333,336,340,341,352,355,358,359,360,361,362,363,365,371,376,388,390,391,394,406,412,414,415,421,422,423,428,429,430,431,434,435,438,444,447,448,449,451,452,459,460,461,467,476,477,480,481,486,487,493,498,500,502,507,509,512,513,515,517,518,521,524,527,529,533,537,539,542,543,550,553,556,559,562,565,566,567,574,580,585,587,590,592,596,602,604,606,607,610,615,616,618,619,620,622,625,628,630,632,635,638,639,643,654,656,658,659,663,665,670,673,674,676,678,683,684,686,688,693,694,696,698,699,700,703,709,710,711,712,724,725,726,727,728,730,731,732,740,744,745,746,747,750,753,756,757,764,768,771,793,795,813,820,830,835,838,844,848,851,854,861,864,866,867,869,871,874,875,879,880,881,882,883,885,890,891,893,894,898,899,901,908,911,913,920,923,924,928,932,934,937,942,945,949,951,955,958,961,968,970,972,978,986,993,999,1000,1005,1010,1014,1016,1020,1027,1031,1034,1038,1048,1053,1057,1058,1064,1065,1071,1074,1075,1078,1081,1083,1084,1085,1089,1097,1102,1103,1106,1108,1111,1116,1119,1122,1127,1128,1133,1139,1187,1208,1218]

def repair():
    conn = sqlite3.connect(DB_FILE)
    cursor = conn.cursor()
    print(f"Clearing {len(BAD_IDS)} bad indexes...")
    
    placeholders = ','.join('?' * len(BAD_IDS))
    
    # Clear main table
    cursor.execute(f"UPDATE books SET index_text = NULL, index_version = 0 WHERE id IN ({placeholders})", BAD_IDS)
    
    # Clear FTS (FTS update triggers usually handle this if triggers exist, otherwise direct update)
    # Using ' ' instead of NULL/Empty string for FTS sometimes safer to avoid quirks
    cursor.execute(f"UPDATE books_fts SET index_content = ' ' WHERE rowid IN ({placeholders})", BAD_IDS)
    
    conn.commit()
    conn.close()
    print("Done. Bad indexes cleared.")

if __name__ == "__main__":
    repair()
